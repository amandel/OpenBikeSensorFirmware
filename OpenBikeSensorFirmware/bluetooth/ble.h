#ifndef BLE_H
#define BLE_H

#include <Arduino.h>
#include <BLEDevice.h>
#include <BLEServer.h>
#include <BLEDescriptor.h>
#include <BLEUtils.h>
#include <BLE2902.h>
#include "BLE_DISTANCE_SENSOR_V3.h"
#include "globals.h"

#define SERVICE_DEVICE_UUID "0000180A-0000-1000-8000-00805F9B34FB"
#define SERVICE_DEVICE_CHAR_SYSTEMID_UUID "00002a23-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_SYSTEMID_VALUE_HEX {0x0B, 0xBA, 0x2D, 0xFE, 0xFF, 0x1A, 0x9E, 0xA0}
#define SERVICE_DEVICE_CHAR_SYSTEMID_VALUE_HEX_LEN 8
#define SERVICE_DEVICE_CHAR_MODELNUMBER_STRING_UUID "00002a24-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_MODELNUMBER_STRING_VALUE "H7"
#define SERVICE_DEVICE_CHAR_SERIALNUMBER_STRING_UUID "00002a25-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_SERIALNUMBER_STRING_VALUE "20182DBA0B"
#define SERVICE_DEVICE_CHAR_FIRMWAREREVISON_UUID "00002a26-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_FIRMWAREREVISON_VALUE "1.4.0"
#define SERVICE_DEVICE_CHAR_HARDWAREREVISION_UUID "00002a27-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_HARDWAREREVISION_VALUE "39044024.10"
#define SERVICE_DEVICE_CHAR_SOFTWAREREVISION_UUID "00002a28-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_SOFTWAREREVISION_VALUE "H7 3.1.0"
#define SERVICE_DEVICE_CHAR_MANUFACTURERNAME_STRING_UUID "00002a29-0000-1000-8000-00805f9b34fb"
#define SERVICE_DEVICE_CHAR_MANUFACTURERNAME_STRING_VALUE "Polar Electro Oy"

#define SERVICE_BATTERY_UUID "0000180f-0000-1000-8000-00805f9b34fb"
#define SERVICE_BATTERY_CHAR_UUID "00002A19-0000-1000-8000-00805F9B34FB"

#define SERVICE_CONNECTION_UUID "1FE7FAF9-CE63-4236-0002-000000000000"
#define SERVICE_CONNECTION_CHAR_CONNECTED_UUID "1FE7FAF9-CE63-4236-0002-000000000001"

#define SERVICE_HEARTRATE_UUID "0000180D-0000-1000-8000-00805F9B34FB"
#define SERVICE_HEARTRATE_DESCRIPTOR_UUID "00002902-0000-1000-8000-00805f9b34fb"
#define SERVICE_HEARTRATE_CHAR_HEARTRATE_UUID "00002a37-0000-1000-8000-00805f9b34fb"
#define SERVICE_HEARTRATE_CHAR_SENSORLOCATION_UUID "00002a38-0000-1000-8000-00805f9b34fb"
#define SERVICE_HEARTRATE_CHAR_SENSORLOCATION_VALUE 1

#define SERVICE_DISTANCE_UUID "1FE7FAF9-CE63-4236-0001-000000000000"
#define SERVICE_DISTANCE_CHAR_50MS_UUID "1FE7FAF9-CE63-4236-0001-000000000001"

#define SERVICE_CLOSEPASS_UUID "1FE7FAF9-CE63-4236-0003-000000000000"
#define SERVICE_CLOSEPASS_CHAR_UUID "1FE7FAF9-CE63-4236-0003-000000000001"

void initBluetooth();
void activateBluetooth();
void deactivateBluetooth();
void disconnectDevice();

void writeToConnectionService(uint8_t value);
void writeToHeartRateService(uint8_t *data, size_t length);
void writeToDistanceService(const char *value);
void writeToClosePassService(const char *value);

BLEService *createDeviceInfoService();
BLEService *createBatteryLevelService();
BLEService *createConnectionService();
BLEService *createHeartRateService();
BLEService *createDistanceService();
BLEService *createClosePassService();

#endif